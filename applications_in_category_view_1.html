<!DOCTYPE html>

<html class="dark" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Enterprise App Store - Design Tools</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<style>
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
    </style>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#135bec",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101622",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
<div class="flex min-h-screen">
<!-- SideNavBar -->
<aside class="w-64 flex-shrink-0 bg-white dark:bg-[#181e29] border-r border-gray-200 dark:border-gray-800 flex flex-col">
<div class="flex h-full flex-col justify-between p-4">
<div class="flex flex-col gap-4">
<div class="flex items-center gap-3 p-2">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Enterprise Inc. logo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCe2grI1_X9Sf0Q2Bvl_C5SlSBSVC6aaiUfYg0ET1PpBrhtRPvomoO64IfIsSPZ4GIZvhkB3OEzVk7tkwJxg5Sy8LBhuKg9_LVi59jEKUMs5rywWxtk4xreHvlcVv5XOau3ljgh9u0NChVHmnJ6kg9ZIjtleD7MAugjLPowGogmxx2uin9oSK7SW58XGRM2CXf6KSlnnU0kJNNjbIagRkK2mpgIYRS6GZUe2PYh8kAz5rUfZ6VK_CYfdPbmRcdtzBCZDQep6RieUmQ");'></div>
<div class="flex flex-col">
<h1 class="text-gray-900 dark:text-white text-base font-semibold leading-normal">Enterprise Inc.</h1>
<p class="text-gray-500 dark:text-[#9da6b9] text-sm font-normal leading-normal">App Store</p>
</div>
</div>
<nav class="flex flex-col gap-2 mt-4">
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="marketplaces_&_categories_overview.html">
<span class="material-symbols-outlined">home</span>
<p class="text-sm font-medium leading-normal">Home</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="applications_in_category_view_1.html">
<span class="material-symbols-outlined">apps</span>
<p class="text-sm font-medium leading-normal">All Apps</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-primary/10 dark:bg-primary/20 text-primary dark:text-white" href="marketplaces_&_categories_overview.html">
<span class="material-symbols-outlined !font-bold" style="font-variation-settings: 'FILL' 1;">folder</span>
<p class="text-sm font-semibold leading-normal">Categories</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="applications_in_category_view_4.html">
<span class="material-symbols-outlined">download</span>
<p class="text-sm font-medium leading-normal">Updates</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="applications_in_category_view_2.html">
<span class="material-symbols-outlined">person</span>
<p class="text-sm font-medium leading-normal">My Apps</p>
</a>
</nav>
</div>
<div class="flex flex-col gap-4">
<a class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-wide hover:bg-primary/90 transition-colors" href="applications_in_category_view_3.html">
<span class="truncate">Request an App</span>
</a>
<div class="flex flex-col gap-1 border-t border-gray-200 dark:border-gray-800 pt-4">
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="admin:_manage_app_folders_1.html">
<span class="material-symbols-outlined">settings</span>
<p class="text-sm font-medium leading-normal">Settings</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-background-dark" href="applications_in_category_view_3.html">
<span class="material-symbols-outlined">help</span>
<p class="text-sm font-medium leading-normal">Help &amp; Support</p>
</a>
</div>
</div>
</div>
</aside>
<!-- Main Content -->
<main class="flex-1 p-8 overflow-y-auto">
<div class="max-w-7xl mx-auto">
<!-- Breadcrumbs -->
<div class="flex flex-wrap gap-2 items-center">
<a class="text-gray-500 dark:text-[#9da6b9] text-sm font-medium leading-normal hover:text-primary" href="marketplaces_&_categories_overview.html">Home</a>
<span class="material-symbols-outlined text-gray-400 dark:text-gray-600 text-lg">chevron_right</span>
<a class="text-gray-500 dark:text-[#9da6b9] text-sm font-medium leading-normal hover:text-primary" href="marketplaces_&_categories_overview.html">Productivity</a>
<span class="material-symbols-outlined text-gray-400 dark:text-gray-600 text-lg">chevron_right</span>
<span class="text-gray-800 dark:text-white text-sm font-medium leading-normal">Design Tools</span>
</div>
<!-- Page Heading -->
<div class="mt-6">
<div class="flex flex-wrap justify-between items-start gap-4">
<div class="flex flex-col gap-2">
<h1 class="text-gray-900 dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Design Tools</h1>
<p class="text-gray-500 dark:text-[#9da6b9] text-base font-normal leading-normal max-w-2xl">A collection of powerful tools for UI/UX designers, graphic artists, and creative professionals.</p>
</div>
</div>
</div>
<!-- Toolbar & Filters -->
<div class="flex flex-wrap justify-between items-center gap-4 mt-8 pb-4 border-b border-gray-200 dark:border-gray-800">
<div class="relative w-full max-w-xs">
<span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500">search</span>
<input id="searchInput" class="w-full h-10 pl-10 pr-4 rounded-lg bg-gray-100 dark:bg-[#181e29] border-transparent focus:ring-2 focus:ring-primary focus:border-transparent text-sm" placeholder="Search in Design Tools..." type="text"/>
</div>
<div class="flex flex-wrap gap-3 items-center">
<label class="flex h-10 items-center gap-2 rounded-lg bg-white dark:bg-[#181e29] border border-gray-300 dark:border-gray-700 px-3 text-sm text-gray-800 dark:text-white">
<span class="font-medium">Sort:</span>
<select id="sortSelect" class="bg-transparent focus:outline-none">
<option value="az">Name A-Z</option>
<option value="za">Name Z-A</option>
<option value="status">Status</option>
<option value="recent">Recently Updated</option>
</select>
</label>
<label class="flex h-10 items-center gap-2 rounded-lg bg-white dark:bg-[#181e29] border border-gray-300 dark:border-gray-700 px-3 text-sm text-gray-800 dark:text-white">
<span class="font-medium">Status:</span>
<select id="statusFilter" class="bg-transparent focus:outline-none">
<option value="all">All</option>
<option value="available">Available</option>
<option value="installed">Installed</option>
<option value="update">Update Available</option>
</select>
</label>
<button id="viewToggle" class="flex h-10 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-white dark:bg-[#181e29] border border-gray-300 dark:border-gray-700 px-4 text-gray-800 dark:text-white text-sm font-medium leading-normal hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
<span class="material-symbols-outlined text-gray-500 dark:text-gray-400" style="font-size: 20px;">view_list</span>
<span class="toggle-label">List View</span>
</button>
</div>
</div>
<!-- Admin Supabase Controls -->
<div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-4 bg-white dark:bg-[#181e29] border border-gray-200 dark:border-gray-800 rounded-xl p-4">
  <div>
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg font-bold text-gray-900 dark:text-white">Supabase Admin Controls</h3>
      <span class="text-xs px-2 py-1 rounded-full bg-primary/10 text-primary">Admin only</span>
    </div>
    <p class="text-sm text-gray-500 dark:text-[#9da6b9]">Create categories to organize applications before adding them to the store.</p>
    <form id="newCategoryForm" class="mt-3 space-y-3">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          Category Name
          <input id="categoryName" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2" placeholder="Design Tools" required />
        </label>
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          Slug
          <input id="categorySlug" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2" placeholder="design-tools" required />
        </label>
      </div>
      <button type="submit" class="w-full h-10 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90">Save Category to Supabase</button>
      <p id="categoryMessage" class="text-sm text-gray-500 dark:text-gray-400"></p>
    </form>
  </div>
  <div>
    <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-3">Add App to Supabase</h3>
    <p class="text-sm text-gray-500 dark:text-[#9da6b9]">Store new applications directly in Supabase so the catalog stays in sync across pages.</p>
    <form id="newAppForm" class="mt-3 space-y-3">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          App Name
          <input id="appName" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2" placeholder="New Design Tool" required />
        </label>
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          Status
          <select id="appStatus" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2">
            <option value="available">Available</option>
            <option value="installed">Installed</option>
            <option value="update">Update</option>
          </select>
        </label>
      </div>
      <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
        Description
        <textarea id="appDescription" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2" rows="2" placeholder="Short description"></textarea>
      </label>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          Image URL
          <input id="appImage" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2" placeholder="https://..." />
        </label>
        <label class="flex flex-col text-sm font-medium text-gray-700 dark:text-gray-200">
          Category
          <select id="appCategory" class="mt-1 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2"></select>
        </label>
      </div>
      <button type="submit" class="w-full h-10 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90">Save App to Supabase</button>
      <p id="appMessage" class="text-sm text-gray-500 dark:text-gray-400"></p>
    </form>
  </div>
</div>
<!-- Application Grid -->
<div id="appsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-8"></div>
<!-- Empty State Example -->
<div id="emptyState" class="mt-16 flex flex-col items-center justify-center text-center p-8 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl hidden">
<span class="material-symbols-outlined text-5xl text-gray-400 dark:text-gray-500 mb-4">search_off</span>
<h3 class="text-xl font-bold text-gray-900 dark:text-white">No applications found</h3>
<p class="text-gray-500 dark:text-[#9da6b9] mt-2">Your search or filter criteria did not match any applications in this category.</p>
<button id="clearFilters" class="mt-6 flex items-center justify-center rounded-lg h-10 px-5 bg-primary text-white text-sm font-bold leading-normal tracking-wide hover:bg-primary/90 transition-colors">Clear Filters</button>
</div>
</div>
</main>
</div>
<script type="module" src="./supabase-client.js"></script>
<script type="module">
  import { supabase } from './supabase-client.js';

  const defaultApps = [
    {
      name: "Figma",
      description: "The collaborative interface design tool. Create, test, and ship better designs from start to finish.",
      status: "available",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCTzCMGEPNfUBci7AaGvhz8lnxSiQfx6mCLHAIgjQhxNQk-Kw1rS_0wnD_rQ3jsTTigFwXKMaETCZ6Ao5ngSntEflka5t1606NY9PM2Xon-i9mxaKA_QN99veBwTvECwn2TSfUrEIIXq9W_LF8gmZvHQbiqnwT8dfOYpsSRGmWfezLdgmfIh2LORCOwoD5ukv82d_FzLkA8LjlmsZTG6Os2wiPlkEjl0CrQiyL-jMGmv0z7GMvZ6v1e4MHZkhRQ_NptCdhzWR1OxXs",
      updatedAt: 4,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Adobe Photoshop",
      description: "The industry standard for digital image processing and editing.",
      status: "installed",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuAZO1k392hcAYRimeUwTIl0MRUyed9Y_mHNWar0537euAvlYFtzzTwrjJ_mk84dANWumhutQy4QtAr6BfNRZFKlOJLuYwWLPYfS_z4UOBgDj9IUPf7EII5Y2WV8B9KJoqZtmI6PqF3hVQDWXH4d82IeUi5THoYHcOdEAThAKsdcf0_3d94YOljbk_Qt8IApOPt3ugYEhdf6aCzjZyEw6G8QV9D397Hep7UsdynfwPVF4pfRsoLMzquHpnhiMHKWt_fFrhbYgxT5Qnc",
      updatedAt: 6,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Sketch",
      description: "A powerful vector graphics editor for macOS, known for its focus on UI/UX design.",
      status: "available",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuDTeFXI2EAn1WDBRvd7U7c-5UJbXnLclNt9rYEV8jY_t3yPGprkFP5aKFbgF7K5wfluRRSL6tdEXvwHE1tKXskcuMre3SGPzKULsihj4gITMnx1I5X0Ru_oDy7hRlXpbtvqRQM28dUj8N5lNfGBVPZKj-C3YlagudXtnm7U-LJcHV1wk3ZFnRdt3UKU8AWrk64F_lghYzkVKQ4KO5PeHmTPUrhQjYQR3BErcwqeHhDuzPAWIocFUvj_C2yOfQH3d9w5zU6ixfdAtCA",
      updatedAt: 3,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "InVision Studio",
      description: "The world's most powerful screen design tool with prototyping and animation features.",
      status: "update",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuAtJFHseySm85a5CIbkl27K0vWLMgNAQ6VV_lzYiNoxRx-uTMZn8d8o6apFE3g5Pi44LkCUQZpFLmFNVvpk6kDllaubW1vE6Od-O7JTsvzbGBZxQDH8aJPR2xnq_lSz79-vYsl-JaRmyTr9WYAKdU_uiiWsBsL_gWGnwV-TzPcSo19F9xZNtbjBOMLQ9m1khY-orcPrmQrJ7jSIao7fp51NbflNU3l7o6g0T6weikgk5qv07YjrzBiObObo3gKMNjAK2Sw2aBMjXCc",
      updatedAt: 9,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Canva",
      description: "Create beautiful designs with your team. Use Canva's drag-and-drop feature and layouts.",
      status: "available",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuBnCFxEfk1hwarR7Xl8CV91C1oPi21X6kV8d_mJyBQ1RAOWYfCnjIcIWlYSRqi5YFHdjliqEe8fRrcxAV5jN4GdMlH9D4_w7lx9VjnXXXe4EtNgAkj3hHDPYBbYuRBDknXOLKqV_236D_tXPOSEOv8DFKzzNpPcrdzRMG6G-BaG2IeZfXcraQyUC0hg3vwzC3cykwD9RiaInJFM9BI9NWHXJVswPdFC7J_Isy0zIQCJPyKDvT8jedKfmcRBCza1r0Fc6cTv2CIdfSQ",
      updatedAt: 2,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Principle",
      description: "Design animated and interactive user interfaces for mobile and web apps.",
      status: "available",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCrV3fI5y0tc2pGKjnhEwhgkHoajhtMVpe6YPbpNgA7E01KV8dsm-65PN8vJzmt8Z9oD4g5zImjpU7vHAEKCkcRukZ7GEmV9ynS1w1Zb-UMwXfN466LZHRGYBt4UU-q5xqG_D3JhawvUDby-xfUp5ygqyrxRpJQUe4suanf0xc8lnwi3StInRyXyDRHC3CXx-AyxVtiyHYNn1vL6x1GaBZkSU9yOv-g91kQp_4wGLLQLqxqDKgGaqyv0w8AfZm7MAslg",
      updatedAt: 5,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Axure RP",
      description: "Plan, prototype, and hand off to developers in one powerful design tool.",
      status: "installed",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCI594t9s8OXPZmrrFSChLByXowSP-ysuo2YsDH8apqpRY3yP10Vy5BZ5bIXwjHeuo-i2Z_WAyBREEtnOUXFqGNxMa9dJGaObruY1tDkuMhXrzv_dv_YaA40TfKHMfg8tcap9Wyry5YIbM3BwKaIMVRnW6OiipE32j5NxGQ0yXQmHXa53i5EiN9FGJueJpY0m0pYdjDCq_s7Z7bJ_15OCWxZAE6d4DtzTsJGTzWBkavv-SoA3Q0szwqnZZU",
      updatedAt: 8,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "LottieFiles",
      description: "Discover, test and share Lottie animations. Integrate motion easily into your designs.",
      status: "available",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuDtuf6OXPmzhthlaQ-q6h3YQF32b3sv5b0QLmePd2c6aUyw92Hk_Uxe3i9JhN0EU3SOfHVF9xdHkjkQ75UqDm_1NdWpdkECKERSLtLbIF2-8_TLyU4O_ZMmxFbxXJjXBa1ePF6NPiXWfHyHHkpKsFB1YvE2vjlbCFxzwft-CIUzVnFhm8z4gSeyxrNKeG67yKPDcnpo1dDPXlUQrBvVnwNPgmOrIX7B7tt_Zp4ETy6jL8Pa",
      updatedAt: 1,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
    {
      name: "Miro",
      description: "Collaborative whiteboard platform that helps teams plan, design, and brainstorm visually.",
      status: "installed",
      image: "https://lh3.googleusercontent.com/aida-public/AB6AXuCSsHwZSt4ajqiCe9MJAZJlo2P8suM1cP3r5eCVbHusLY-m4SOcsnSKHMy7G_92OLig_1jz-Y_Gp2HzYdVvj9ytEhfWzoT5gze-qG9_OyfNWhgx3-qGY9doB4Mzn_6iQ-WEvLmmouDk9aAYhZ5FjNcPN3VAPv-78_8j-eUT7TGg2Atq6mWQfJLU7wqXsIKBv74o2mWUDRz7aEUQx-EdzX3KW2aUVUHJjhq5_7UgCQt0xr96eu4KMPFChS0y_8T3kyd",
      updatedAt: 7,
      detailLink: "applications_in_category_view_2.html",
      category_slug: "design-tools",
    },
  ];

  const appsContainer = document.getElementById("appsContainer");
  const emptyState = document.getElementById("emptyState");
  const searchInput = document.getElementById("searchInput");
  const sortSelect = document.getElementById("sortSelect");
  const statusFilter = document.getElementById("statusFilter");
  const viewToggle = document.getElementById("viewToggle");
  const clearFilters = document.getElementById("clearFilters");
  const categorySelect = document.getElementById('appCategory');
  const categoryMessage = document.getElementById('categoryMessage');
  const categoryName = document.getElementById('categoryName');
  const categorySlug = document.getElementById('categorySlug');
  const newCategoryForm = document.getElementById('newCategoryForm');
  const newAppForm = document.getElementById('newAppForm');
  const appMessage = document.getElementById('appMessage');
  const appName = document.getElementById('appName');
  const appStatus = document.getElementById('appStatus');
  const appDescription = document.getElementById('appDescription');
  const appImage = document.getElementById('appImage');
  const appCategory = document.getElementById('appCategory');

  let isListView = false;
  let apps = [...defaultApps];
  let categories = [{ name: 'Design Tools', slug: 'design-tools' }];

  const statusStyles = {
    installed: "bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300",
    update: "bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300",
    available: "",
  };

  const statusPriority = { installed: 0, update: 1, available: 2 };

  const setInlineMessage = (element, text, isError = false) => {
    if (!element) return;
    element.textContent = text;
    element.classList.toggle('text-red-500', isError);
    element.classList.toggle('text-green-600', !isError);
  };

  function buildCard(app) {
    const card = document.createElement("div");
    card.className = `bg-white dark:bg-[#181e29] rounded-xl border border-gray-200 dark:border-gray-800 p-5 flex flex-col gap-4 hover:shadow-lg hover:border-primary/50 dark:hover:border-primary/50 transition-all duration-300 ${isListView ? "md:flex-row md:items-start md:gap-4" : ""}`;

    const badge = app.status !== "available" ? `<span class="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${statusStyles[app.status]}">${app.status === "update" ? "Update" : "Installed"}</span>` : "";
    const primaryLabel = app.status === "installed" ? "Open" : app.status === "update" ? "Update" : "Install";
    const primaryColor = app.status === "installed" ? "bg-green-600 hover:bg-green-700" : app.status === "update" ? "bg-orange-500 hover:bg-orange-600" : "bg-primary hover:bg-primary/90";

    card.innerHTML = `
      <div class="flex items-start justify-between gap-3 ${isListView ? "md:w-48" : ""}">
        <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-lg size-14" data-alt="${app.name} app icon" style='background-image: url("${app.image}");'></div>
        ${badge}
      </div>
      <div class="flex flex-col gap-1 flex-grow ${isListView ? "md:flex-1" : ""}">
        <h3 class="text-gray-900 dark:text-white text-lg font-bold leading-normal">${app.name}</h3>
        <p class="text-gray-500 dark:text-[#9da6b9] text-sm font-normal leading-normal line-clamp-2">${app.description}</p>
      </div>
      <div class="flex items-center gap-2 mt-2 ${isListView ? "md:w-full" : ""}">
        <a class="flex flex-1 items-center justify-center overflow-hidden rounded-lg h-9 px-4 ${primaryColor} text-white text-sm font-bold leading-normal tracking-wide transition-colors" href="${app.detailLink}">${primaryLabel}</a>
        <a class="flex flex-1 items-center justify-center overflow-hidden rounded-lg h-9 px-4 bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-white text-sm font-medium leading-normal hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors" href="${app.detailLink}">Details</a>
      </div>
    `;

    return card;
  }

  function renderApps() {
    const query = searchInput.value.trim().toLowerCase();
    const statusValue = statusFilter.value;
    let filtered = apps.filter((app) => {
      const matchesQuery = app.name.toLowerCase().includes(query) || app.description.toLowerCase().includes(query);
      const matchesStatus = statusValue === "all" || app.status === statusValue;
      return matchesQuery && matchesStatus;
    });

    filtered = filtered.sort((a, b) => {
      switch (sortSelect.value) {
        case "za":
          return b.name.localeCompare(a.name);
        case "status":
          return statusPriority[a.status] - statusPriority[b.status] || a.name.localeCompare(b.name);
        case "recent":
          return (b.updatedAt || 0) - (a.updatedAt || 0);
        case "az":
        default:
          return a.name.localeCompare(b.name);
      }
    });

    appsContainer.innerHTML = "";

    if (!filtered.length) {
      appsContainer.classList.add("hidden");
      emptyState.classList.remove("hidden");
      return;
    }

    appsContainer.classList.remove("hidden");
    emptyState.classList.add("hidden");
    appsContainer.className = isListView
      ? "grid grid-cols-1 gap-4 mt-8"
      : "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mt-8";

    filtered.forEach((app) => {
      appsContainer.appendChild(buildCard(app));
    });
  }

  function resetFilters() {
    searchInput.value = "";
    sortSelect.value = "az";
    statusFilter.value = "all";
    renderApps();
  }

  function populateCategorySelect() {
    if (!categorySelect) return;
    categorySelect.innerHTML = categories
      .map((cat) => `<option value="${cat.slug}">${cat.name}</option>`)
      .join("");
  }

  async function hydrateCategories() {
    const { data, error } = await supabase.from('categories').select('name,slug').order('name');
    if (!error && data?.length) {
      categories = data;
    }
    populateCategorySelect();
  }

  async function hydrateApps() {
    const { data, error } = await supabase
      .from('apps')
      .select('id,name,description,status,image,updated_at,detail_path,category_slug')
      .order('updated_at', { ascending: false });

    if (!error && data?.length) {
      apps = data.map((app) => ({
        name: app.name,
        description: app.description || '',
        status: app.status || 'available',
        image: app.image || 'https://placehold.co/280x180/png',
        updatedAt: app.updated_at ? new Date(app.updated_at).getTime() : 0,
        detailLink: app.detail_path || 'applications_in_category_view_2.html',
        category_slug: app.category_slug || 'design-tools',
      }));
    }

    renderApps();
  }

  newCategoryForm?.addEventListener('submit', async (event) => {
    event.preventDefault();
    setInlineMessage(categoryMessage, 'Saving category...');
    const { error } = await supabase.from('categories').upsert({
      name: categoryName.value,
      slug: categorySlug.value,
    });

    if (error) {
      setInlineMessage(categoryMessage, error.message, true);
      return;
    }

    categories = [...categories.filter((c) => c.slug !== categorySlug.value), { name: categoryName.value, slug: categorySlug.value }];
    populateCategorySelect();
    setInlineMessage(categoryMessage, 'Category saved to Supabase.');
    categoryName.value = '';
    categorySlug.value = '';
  });

  newAppForm?.addEventListener('submit', async (event) => {
    event.preventDefault();
    setInlineMessage(appMessage, 'Saving app to Supabase...');
    const payload = {
      name: appName.value,
      description: appDescription.value,
      status: appStatus.value,
      image: appImage.value,
      category_slug: appCategory.value,
      detail_path: 'applications_in_category_view_2.html',
    };

    const { data, error } = await supabase.from('apps').insert(payload).select().maybeSingle();

    if (error) {
      setInlineMessage(appMessage, error.message, true);
      return;
    }

    apps.unshift({
      name: payload.name,
      description: payload.description,
      status: payload.status,
      image: payload.image || 'https://placehold.co/280x180/png',
      updatedAt: Date.now(),
      detailLink: payload.detail_path,
      category_slug: payload.category_slug,
      id: data?.id,
    });

    renderApps();
    setInlineMessage(appMessage, 'App saved to Supabase and synced.');
    newAppForm.reset();
  });

  searchInput.addEventListener("input", renderApps);
  sortSelect.addEventListener("change", renderApps);
  statusFilter.addEventListener("change", renderApps);
  clearFilters.addEventListener("click", resetFilters);
  viewToggle.addEventListener("click", () => {
    isListView = !isListView;
    const icon = viewToggle.querySelector(".material-symbols-outlined");
    const label = viewToggle.querySelector(".toggle-label");
    icon.textContent = isListView ? "view_module" : "view_list";
    label.textContent = isListView ? "Grid View" : "List View";
    renderApps();
  });

  populateCategorySelect();
  hydrateCategories().finally(hydrateApps);
  renderApps();
</script>
</body></html>